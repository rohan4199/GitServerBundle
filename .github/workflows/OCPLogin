
name: Login to OpenShift (OCP)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  ocp-login:
    runs-on: ubuntu-latest

    steps:
      # Checkout (not strictly required for login, but common in workflows)
      - name: Checkout
        uses: actions/checkout@v4

      # Login using the official Red Hat action
      - name: Login to OpenShift
        uses: redhat-actions/oc-login@v1
        with:
          openshift_server_url: ${{ secrets.OCP_SERVER_URL }}
          openshift_token: ${{ secrets.OCP_TOKEN  }}
          
      # (Optional) Switch to a namespace/project
      - name: Set project (namespace)
        if: ${{ secrets.OPENSHIFT_NAMESPACE != '' }}
        run: |
          oc project "${{ secrets.OPENSHIFT_NAMESPACE }}"

      # Verify login and show cluster info
      - name: Verify oc context
        run: |
          oc whoami
          oc whoami --show-server
          oc get projects --no-headers | head -n 10
          oc get nodes -o wide || true

      # Example: use oc to list pods in the namespace
      - name: List pods
        run: |
          oc get pods -n "${{ secrets.OPENSHIFT_NAMESPACE }}"
